from googleapiclient.discovery import build

# üîë –¢–≤—ñ–π API –∫–ª—é—á –∑ Google Cloud Console
API_KEY = "AIzaSyDOEOiDtfTITXQjMqiSDXj0rALBSeotBBU"

# üî∑ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–∞–Ω–∞–ª—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: UC_x5XG1OV2P6uZZ5FSM9Ttw ‚Äî —Ü–µ Google Developers)
CHANNEL_ID = "UC_x5XG1OV2P6uZZ5FSM9Ttw"

# –°—Ç–≤–æ—Ä—é—î–º–æ –∫–ª—ñ—î–Ω—Ç YouTube API
youtube = build('youtube', 'v3', developerKey=API_KEY)

# ------------------- 1Ô∏è‚É£ –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—ñ–¥–µ–æ –∑ –∫–∞–Ω–∞–ª—É -------------------
def get_videos_from_channel(channel_id):
    videos = []
    next_page_token = None

    while True:
        request = youtube.search().list(
            part='snippet',
            channelId=channel_id,
            maxResults=50,
            order='date',  # –Ω–∞–π–Ω–æ–≤—ñ—à—ñ —Å–ø–æ—á–∞—Ç–∫—É
            pageToken=next_page_token
        )
        response = request.execute()

        for item in response['items']:
            if item['id']['kind'] == 'youtube#video':
                videos.append({
                    'title': item['snippet']['title'],
                    'videoId': item['id']['videoId']
                })

        next_page_token = response.get('nextPageToken')
        if not next_page_token:
            break

    return videos

# ------------------- 2Ô∏è‚É£ –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ –≤—ñ–¥–µ–æ -------------------
def get_comments(video_id):
    comments = []
    next_page_token = None

    while True:
        request = youtube.commentThreads().list(
            part='snippet',
            videoId=video_id,
            maxResults=50,
            textFormat='plainText',
            pageToken=next_page_token
        )
        response = request.execute()

        for item in response['items']:
            top_comment = item['snippet']['topLevelComment']['snippet']
            comments.append({
                'author': top_comment['authorDisplayName'],
                'text': top_comment['textDisplay'],
                'likeCount': top_comment['likeCount']
            })

        next_page_token = response.get('nextPageToken')
        if not next_page_token:
            break

    return comments

# ------------------- 3Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ -------------------
videos = get_videos_from_channel(CHANNEL_ID)

if videos:
    latest_video = videos[0]
    print(f"\nüÜï –û—Å—Ç–∞–Ω–Ω—î –≤—ñ–¥–µ–æ: {latest_video['title']} (ID: {latest_video['videoId']})")

    comments = get_comments(latest_video['videoId'])
    print(f"\nüí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ '{latest_video['title']}':")
    for i, comment in enumerate(comments[:10], start=1):
        print(f"{i}. {comment['author']}: {comment['text']} (üëç {comment['likeCount']})")

else:
    print("‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤—ñ–¥–µ–æ –Ω–∞ —Ü—å–æ–º—É –∫–∞–Ω–∞–ª—ñ.")